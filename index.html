<!DOCTYPE html>
<html>
<head>
    <title>Forest Service Application Taxonomy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        #container {
            width: 100%;
            height: 100vh;
            display: flex;
        }
        #graph {
            flex: 1;
            background: white;
        }
        .node {
            cursor: pointer;
        }
        .node circle {
            stroke: #fff;
            stroke-width: 2px;
        }
        .node text {
            font-size: 12px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 1px;
        }
        .tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            max-width: 250px;
        }
        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="graph"></div>
    </div>

    <script>
        // Data structure for the application taxonomy
        const data = {
            nodes: [
                // Program Areas (Parent Nodes)
                { id: "fire", name: "Fire Management", type: "program",
                  description: "Applications supporting wildland fire management and response" },
                { id: "recreation", name: "Recreation", type: "program",
                  description: "Applications for recreation and visitor services management" },
                { id: "timber", name: "Timber Management", type: "program",
                  description: "Applications for forest products and timber sale management" },
                { id: "wildlife", name: "Wildlife & Fish", type: "program",
                  description: "Applications supporting wildlife and fisheries management" },
                { id: "lands", name: "Lands & Minerals", type: "program",
                  description: "Applications for land ownership and minerals management" },

                // Fire Management Applications
                { id: "wfdss", name: "WFDSS", type: "application", program: "fire",
                  description: "Wildland Fire Decision Support System - Fire management planning and decision documentation",
                  status: "Active" },
                { id: "iftdss", name: "IFTDSS", type: "application", program: "fire",
                  description: "Interagency Fuel Treatment Decision Support System - Fuel treatment planning and analysis",
                  status: "Active" },
                { id: "firestat", name: "FireStat", type: "application", program: "fire",
                  description: "Fire statistics and reporting system for incident management",
                  status: "Active" },

                // Recreation Applications
                { id: "rec_gov", name: "Recreation.gov", type: "application", program: "recreation",
                  description: "Public reservation system for recreation facilities and permits",
                  status: "Active" },
                { id: "infra", name: "INFRA", type: "application", program: "recreation",
                  description: "Infrastructure inventory and condition assessment system",
                  status: "Active" },
                { id: "suds", name: "SUDS", type: "application", program: "recreation",
                  description: "Special Use Data System for permit management",
                  status: "Active" },

                // Timber Applications
                { id: "tims", name: "TIMS", type: "application", program: "timber",
                  description: "Timber Information Management System for timber sale tracking",
                  status: "Active" },
                { id: "facts", name: "FACTS", type: "application", program: "timber",
                  description: "Forest Activity Tracking System for silvicultural activities",
                  status: "Active" },
                { id: "posts", name: "PostSale", type: "application", program: "timber",
                  description: "Timber sale accounting and management system",
                  status: "Active" },

                // Wildlife Applications
                { id: "wild_obs", name: "Wildlife Obs", type: "application", program: "wildlife",
                  description: "Wildlife observation and monitoring database",
                  status: "Active" },
                { id: "nris", name: "NRIS Wildlife", type: "application", program: "wildlife",
                  description: "Natural Resource Information System - Wildlife module",
                  status: "Active" },

                // Lands Applications
                { id: "lrmp", name: "LRMP", type: "application", program: "lands",
                  description: "Land Resource Management Planning system",
                  status: "Active" },
                { id: "lands", name: "LandStatus", type: "application", program: "lands",
                  description: "Land ownership and status tracking system",
                  status: "Active" }
            ],
            links: []
        };

        // Generate links based on program relationships
        data.nodes.forEach(node => {
            if (node.type === "application") {
                data.links.push({
                    source: node.program,
                    target: node.id,
                    value: 1
                });
            }
        });

        // Add some cross-program dependencies
        data.links.push(
            { source: "tims", target: "facts", value: 1 },
            { source: "wfdss", target: "iftdss", value: 1 },
            { source: "infra", target: "suds", value: 1 },
            { source: "wild_obs", target: "nris", value: 1 }
        );

        // Set up the visualization
        const width = window.innerWidth;
        const height = window.innerHeight;

        const color = d3.scaleOrdinal()
            .domain(["program", "application"])
            .range(["#2c5282", "#48bb78"]);

        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(50));

        const svg = d3.select("#graph")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Create arrow marker for links
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 20)
            .attr("refY", 0)
            .attr("markerWidth", 8)
            .attr("markerHeight", 8)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#999");

        const link = svg.append("g")
            .selectAll("line")
            .data(data.links)
            .join("line")
            .attr("class", "link")
            .attr("marker-end", "url(#arrowhead)");

        const node = svg.append("g")
            .selectAll(".node")
            .data(data.nodes)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        node.append("circle")
            .attr("r", d => d.type === "program" ? 25 : 15)
            .style("fill", d => color(d.type));

        node.append("text")
            .attr("dy", 30)
            .attr("text-anchor", "middle")
            .text(d => d.name)
            .style("fill", "#333");

        // Create tooltip
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Add hover interactions
        node.on("mouseover", function(event, d) {
            tooltip.transition()
                .duration(200)
                .style("opacity", .9);
            tooltip.html(`
                <strong>${d.name}</strong><br/>
                Type: ${d.type}<br/>
                ${d.description}<br/>
                ${d.status ? `Status: ${d.status}` : ""}
            `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        })
        .on("mouseout", function() {
            tooltip.transition()
                .duration(500)
                .style("opacity", 0);
        });

        // Add legend
        const legend = d3.select("#graph")
            .append("div")
            .attr("class", "legend");

        const legendData = [
            { type: "program", label: "Program Area" },
            { type: "application", label: "Application" }
        ];

        const legendItems = legend.selectAll(".legend-item")
            .data(legendData)
            .enter()
            .append("div")
            .attr("class", "legend-item");

        legendItems.append("div")
            .attr("class", "legend-color")
            .style("background-color", d => color(d.type));

        legendItems.append("span")
            .text(d => d.label);

        // Simulation tick function
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // Drag functions
        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            const width = window.innerWidth;
            const height = window.innerHeight;

            svg
                .attr("width", width)
                .attr("height", height);

            simulation
                .force("center", d3.forceCenter(width / 2, height / 2))
                .restart();
        });
    </script>
</body>
</html>
